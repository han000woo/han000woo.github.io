name: Deploy Vue to /cote-repo-monitoring

on:
  push:
    branches:
      - main
  # (추가) 수동으로 실행할 수 있도록 허용
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        # v3 대신 최신 v4 사용
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          # (추가) npm 캐시로 설치 속도 향상
          cache: 'npm'
          # (수정) package-lock.json 파일 위치를 정확히 지정
          cache-dependency-path: ./cote-repo-monitoring/package-lock.json

      - name: Install dependencies
        # 'npm ci'는 package-lock.json을 기반으로 더 빠르고 일관되게 설치합니다.
        working-directory: ./cote-repo-monitoring
        run: npm ci

      - name: Build Vue project
        working-directory: ./cote-repo-monitoring
        # (매우 중요)
        # Vite 빌드 시, 하위 디렉토리 배포를 위해 'base' 경로를 설정합니다.
        run: npm run build -- --base=/cote-repo-monitoring/

      # --------------------------------------------------------------------
      # (수정) 복잡한 수동 git 명령어를 모두 이 Action으로 대체합니다.
      # --------------------------------------------------------------------
      - name: Deploy to gh-pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          # GitHub Actions가 자동으로 발급하는 토큰
          github_token: ${{ secrets.GITHUB_TOKEN }}
          
          # 배포할 브랜치
          publish_branch: gh-pages
          
          # (원본) 빌드 결과물이 있는 폴더
          publish_dir: ./cote-repo-monitoring/dist
          
          # (대상) gh-pages 브랜치에 배포될 하위 폴더 이름
          destination_dir: cote-repo-monitoring
          
          # (권장) 배포할 때마다 이전 파일을 삭제하여 깨끗하게 유지
          keep_files: false